<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MacroPeso Inteligente</title>
  <style>
    :root{
      --bg:#070a07;
      --card:rgba(20,25,20,.70);
      --stroke:rgba(255,255,255,.14);
      --txt:#e9eee9;
      --muted:#a7b0a7;
      --green:#18d46f;
      --danger:#ff4d4d;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    body{
      margin:0; min-height:100vh; display:grid; place-items:center;
      background:
        radial-gradient(1000px 600px at 60% 40%, rgba(24,212,111,.25), transparent 60%),
        radial-gradient(900px 500px at 30% 70%, rgba(24,212,111,.12), transparent 60%),
        var(--bg);
      color:var(--txt);
    }
    .wrap{
      width:min(720px,94vw);
      padding:26px;
      border-radius:18px;
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--stroke);
      box-shadow:0 20px 70px rgba(0,0,0,.55);
      position:relative;
      overflow:hidden;
    }
    /* imagens (as duas fotos) */
    .imgs{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      margin-bottom:18px;
    }
    .imgBox{
      border-radius:14px;
      border:1px solid var(--stroke);
      overflow:hidden;
      aspect-ratio: 16/10;
      background:rgba(255,255,255,.03);
    }
    .imgBox img{ width:100%; height:100%; object-fit:cover; display:block; }

    h1{margin:8px 0 6px;font-size:40px;letter-spacing:.2px}
    .sub{margin:0 0 18px;color:var(--muted);font-size:16px}
    label{display:block;margin:12px 0 8px;color:var(--muted);font-weight:600}
    input{
      width:100%;
      padding:16px 14px;
      border-radius:14px;
      border:1px solid rgba(24,212,111,.40);
      outline:none;
      background:rgba(0,0,0,.30);
      color:var(--txt);
      font-size:16px;
    }
    input:focus{border-color:rgba(24,212,111,.85); box-shadow:0 0 0 4px rgba(24,212,111,.12)}
    .row{display:flex; gap:12px; margin-top:14px; flex-wrap:wrap}
    button{
      border:none; border-radius:14px; padding:16px 18px; cursor:pointer;
      font-weight:800; font-size:16px;
    }
    .btnMain{
      flex:1;
      background:linear-gradient(180deg, rgba(24,212,111,1), rgba(15,165,86,1));
      color:#041b0e;
    }
    .btnGhost{
      background:rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      color:var(--txt);
      min-width:160px;
    }
    .msg{
      margin-top:12px;
      font-weight:800;
      color:var(--danger);
      min-height:22px;
    }
    .ok{color:var(--green)}
    .foot{margin-top:10px;color:rgba(255,255,255,.30);font-size:13px}
    @media (max-width:640px){
      h1{font-size:30px}
      .imgs{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- ✅ aqui ficam as 2 fotos (troque os src pelos seus arquivos do repo) -->
    <div class="imgs">
      <div class="imgBox">
        <img src="foto1.jpg" alt="Foto 1">
      </div>
      <div class="imgBox">
        <img src="foto2.jpg" alt="Foto 2">
      </div>
    </div>

    <h1>MacroPeso Inteligente</h1>
    <p class="sub">Digite seu e-mail (compradores) <b>OU</b> o código (convidados).</p>

    <label for="identifier">E-mail ou Código</label>
    <input id="identifier" placeholder="ex: seuemail@gmail.com ou 123456" autocomplete="off" />

    <div class="row">
      <button class="btnMain" id="btnEnter">Entrar</button>
      <button class="btnGhost" id="btnClear">Limpar</button>
      <button class="btnGhost" id="btnHelp">Ajuda</button>
    </div>

    <div class="msg" id="msg"></div>
    <div class="foot">© João Frutuoso</div>
  </div>

<script>
  // ✅ COLE AQUI SUA URL DO WORKER (a sua é essa do print)
  const API_URL = "https://rough-base-6eb1.jlucasandradeee.workers.dev/access";

  const elId = document.getElementById("identifier");
  const elMsg = document.getElementById("msg");
  const btnEnter = document.getElementById("btnEnter");

  document.getElementById("btnClear").onclick = () => {
    localStorage.removeItem("deviceId");
    elId.value = "";
    elMsg.textContent = "";
  };

  document.getElementById("btnHelp").onclick = () => {
    alert("Compradores: digite seu e-mail.\nConvidados: digite o código.\nSe der erro, confirme se digitou certo.");
  };

  btnEnter.onclick = entrar;
  elId.addEventListener("keydown", (e)=>{ if(e.key==="Enter") entrar(); });

  function getOrCreateDeviceId(){
    let id = localStorage.getItem("deviceId");
    if(!id){
      id = (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random());
      localStorage.setItem("deviceId", id);
    }
    return id;
  }

  async function entrar(){
    const identifier = (elId.value || "").trim();
    if(!identifier){
      elMsg.textContent = "Digite um e-mail ou um código.";
      return;
    }

    elMsg.textContent = "Verificando...";
    elMsg.className = "msg";

    const deviceId = getOrCreateDeviceId();

    try{
      const res = await fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ identifier, deviceId })
      });

      const data = await res.json().catch(()=> ({}));

      if(data.ok && data.redirectUrl){
        elMsg.textContent = "Acesso liberado. Entrando...";
        elMsg.className = "msg ok";
        window.location.href = data.redirectUrl;
        return;
      }

      elMsg.textContent = data.message || "Acesso negado. Verifique e tente novamente.";
    }catch(err){
      elMsg.textContent = "Erro de conexão. Tente novamente.";
    }
  }
</script>
</body>
</html>
